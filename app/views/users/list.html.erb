<%= render 'layouts/nav' %>

<div class="grapevine-container">
  <div class="gallery-page-header">
    <h1 class="grapevine-title mb-4"><%= User.model_name.human.pluralize %></h1>
  </div>

  <div class="grapevine-search mb-4">
    <%= render 'search', years: @years, positions: @positions %>
  </div>
  <div class="list-group grapevine-user">
    <% if @users.blank? %>
      <h4>No profiles that matched your search of:</h4>
      <ul>
        <li><strong>Name or email:</strong> <%= params[:search].present? ? params[:search] : "---" %></li>
        <li><strong>Year:</strong> <%= params[:year].present? ? params[:year] : "---" %></li>
        <li><strong>Position:</strong> <%= params[:position].present? ? params[:position] : "---" %></li>
      </ul>
    <% else %>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="panel panel-default panel-table">
              <div class="panel-body">
                <table class="table table-striped table-bordered table-list">
                  <thead>
                  <tr>
                    <th>User</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>City/state</th>
                    <th>Last login</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% @users.each do | user | %>
                    <tr>
                      <td class="display-name"><%= link_to(display_name(user), edit_user_profile_path(user)) %></td>
                      <td class="<%= 'hidden-detail' if user.privacy_settings["personal"]["email"] %>"><%= user.email %></td>
                      <td class="<%= 'hidden-detail' if user.privacy_settings["personal"]["phone"] %>"><%= user.phone %></td>
                      <td class="<%= 'hidden-detail' if user.privacy_settings["personal"]["address"] %>"><%= display_city_state(user) %></td>
                      <td><%= user.last_sign_in_at && user.last_sign_in_at.to_date %></td>
                    </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <p><%= link_to 'New user', root_path, class: "btn btn-primary" %></p>
      </div>
    <% end %>
  </div>
</div>



